# 테스트 가이드 - 리뷰 제출 및 이미지 업로드

## 사전 준비

### 1. 백엔드 서버 확인
백엔드 서버가 실행 중이어야 합니다:
- 기본 URL: `http://127.0.0.1:8000`
- 백엔드 서버가 다른 포트에서 실행 중이라면 `test_server/public/js/api.js`의 `API_BASE_URL`을 수정하세요

### 2. 백엔드 API 엔드포인트 확인
다음 엔드포인트가 작동하는지 확인:
- `POST /shops/` - 매장 생성
- `POST /reviews/{shop_id}/upload-urls` - S3 업로드 URL 요청
- `POST /reviews/{shop_id}` - 리뷰 제출

## 프론트엔드 서버 시작

### 1. 터미널에서 test_server 디렉토리로 이동
```bash
cd test_server
```

### 2. 의존성 설치 (처음 한 번만)
```bash
npm install
```

### 3. 서버 시작
```bash
npm start
```

또는

```bash
node server.js
```

### 서버가 시작되면 다음 메시지가 표시됩니다:
```
✅ Server is running on http://localhost:3000
```

### 4. 브라우저에서 접속
```
http://localhost:3000
```

## 테스트 절차

### 1. 장소 검색 및 선택
1. 브라우저에서 `http://localhost:3000` 접속
2. 검색창에 장소 이름 입력 (예: "스타벅스", "맥도날드")
3. 검색 결과에서 장소 클릭하여 상세 정보 표시

### 2. 리뷰 작성 모달 열기
1. 상세 정보 화면에서 **"리뷰 작성하기"** 버튼 클릭
   - 홈 탭의 "리뷰 작성하기" 링크 또는
   - 리뷰 탭의 "리뷰 작성하기" 버튼

### 3. 리뷰 정보 입력
1. **입구에 들어갈 수 있었나요?** - "있어요" 또는 "없어요" 선택
2. (입구에 들어갈 수 있었을 경우) **혼자서 들어가셨나요?** - "혼자서 들어갔어요" 또는 "도움을 받아 들어갔어요" 선택
3. **입구에 턱이 있었나요?** - "있어요" 또는 "없어요" 선택
4. **입구에 경사로가 있었나요?** - "있어요" 또는 "없어요" 선택
5. **실내 이동은 어땠나요?** - "편해요" 또는 "불편해요" 선택

### 4. 이미지 업로드
1. **사진 업로드** 섹션에서 **"파일 선택"** 클릭
2. 하나 이상의 이미지 파일 선택 (JPG, PNG 등)
3. 선택된 이미지 파일이 표시되는지 확인

### 5. 리뷰 내용 입력
1. **리뷰 내용** 텍스트 영역에 리뷰 내용 입력 (선택사항)

### 6. 리뷰 제출
1. **"저장하기"** 버튼 클릭
2. 버튼이 **"제출 중..."**으로 변경되는지 확인
3. 콘솔에서 진행 상황 확인 (F12 → Console 탭)

## 브라우저 콘솔 확인

브라우저 개발자 도구(F12)를 열고 Console 탭에서 다음 메시지들을 확인하세요:

### 정상적인 흐름:
```
매장 정보 가져오는 중...
매장 ID: 6918a6ad751293593985e6ca
리뷰 데이터: {user_id: "dummy_user_id", enter: true, ...}
이미지 파일 개수: 2
리뷰 저장 완료: {...}
```

### 오류 발생 시:
- CORS 오류: 백엔드 서버에서 CORS 설정 확인
- 매장 ID를 찾을 수 없음: 백엔드 응답 구조 확인
- 이미지 업로드 실패: S3 설정 및 백엔드 업로드 URL 생성 확인

## 네트워크 탭 확인

브라우저 개발자 도구의 Network 탭에서 다음 요청들을 확인:

1. **매장 생성 요청**
   - `POST http://127.0.0.1:8000/shops/`
   - Status: 200 OK

2. **S3 업로드 URL 요청** (이미지가 있는 경우)
   - `POST http://127.0.0.1:8000/reviews/{shop_id}/upload-urls`
   - Status: 200 OK

3. **이미지 업로드** (이미지가 있는 경우)
   - `PUT https://s3.amazonaws.com/...` (S3 URL)
   - Status: 200 또는 204

4. **리뷰 제출 요청**
   - `POST http://127.0.0.1:8000/reviews/{shop_id}`
   - Status: 200 OK

## 문제 해결

### 1. CORS 오류
**증상**: 콘솔에 CORS 관련 오류 메시지

**해결 방법**:
- 백엔드 서버에서 CORS를 허용하도록 설정
- 백엔드가 FastAPI를 사용하는 경우:
  ```python
  from fastapi.middleware.cors import CORSMiddleware
  app.add_middleware(CORSMiddleware, allow_origins=["*"])
  ```

### 2. 매장 ID를 찾을 수 없음
**증상**: "매장 ID를 가져올 수 없습니다" 오류

**해결 방법**:
- 백엔드 응답에서 `_id` 또는 `id` 필드가 반환되는지 확인
- Network 탭에서 매장 생성 응답 확인
- 필요시 `test_server/public/js/events.js`에서 응답 구조에 맞게 수정

### 3. 이미지 업로드 실패
**증상**: 이미지 업로드 중 오류 발생

**해결 방법**:
- S3 버킷 설정 확인
- 백엔드에서 업로드 URL 생성이 올바른지 확인
- 이미지 파일 크기 제한 확인
- Network 탭에서 S3 업로드 요청 상태 확인

### 4. 백엔드 연결 실패
**증상**: "API request failed" 오류

**해결 방법**:
- 백엔드 서버가 실행 중인지 확인
- `test_server/public/js/api.js`의 `API_BASE_URL`이 올바른지 확인
- 백엔드 서버 포트 확인

## 테스트 체크리스트

- [ ] 프론트엔드 서버가 `http://localhost:3000`에서 실행 중
- [ ] 백엔드 서버가 `http://127.0.0.1:8000`에서 실행 중
- [ ] 브라우저에서 프론트엔드 접속 성공
- [ ] 장소 검색 및 선택 성공
- [ ] 리뷰 작성 모달 열기 성공
- [ ] 리뷰 정보 입력 성공
- [ ] 이미지 파일 선택 성공
- [ ] 리뷰 제출 성공
- [ ] 콘솔에 오류 없음
- [ ] Network 탭에서 모든 요청 성공 (200 OK)

## 추가 테스트 시나리오

### 시나리오 1: 이미지 없이 리뷰 제출
- 이미지를 선택하지 않고 리뷰만 제출
- `photo_urls`가 빈 배열로 전송되는지 확인

### 시나리오 2: 여러 이미지 업로드
- 2개 이상의 이미지 선택
- 모든 이미지가 업로드되는지 확인

### 시나리오 3: 같은 장소에 여러 리뷰
- 같은 장소에 여러 번 리뷰 작성
- 매장이 중복 생성되지 않는지 확인 (백엔드에서 처리)

## 성공 확인

리뷰 제출이 성공하면:
1. "리뷰가 저장되었습니다." 알림 표시
2. 리뷰 모달이 자동으로 닫힘
3. 콘솔에 "리뷰 저장 완료" 메시지 표시
4. 백엔드 데이터베이스에 리뷰가 저장됨
5. S3에 이미지가 업로드됨 (이미지가 있는 경우)

