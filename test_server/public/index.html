<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Kakao ì§€ë„</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@500&display=swap" rel="stylesheet">
	<style>
		html, body {
			margin: 0;
			padding: 0;
			width: 100%;
			height: 100%;
			overflow: hidden;
		}
		#map {
			width: 100%;
			height: 100%;
		}
		.search-box {
			position: absolute;
			left: 52px;
			top: 59px;
			width: 383px;
			height: 45px;
			background: #ffffff;
			border: 1px solid #FEE500;
			border-radius: 10px;
			display: flex;
			align-items: center;
			padding: 0 16px;
			box-sizing: border-box;
			z-index: 10;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
		}
		.search-box input {
			flex: 1;
			border: none;
			outline: none;
			font-family: 'Inter', sans-serif;
			font-weight: 500;
			font-size: 15px;
			background: transparent;
			color: #333;
		}
		.search-box input::placeholder {
			color: #999;
		}
		.search-icon {
			width: 20px;
			height: 20px;
			margin-left: 12px;
			cursor: pointer;
		}
		.search-icon svg {
			width: 100%;
			height: 100%;
			fill: #666;
		}
	.place-detail {
		position: absolute;
		left: 52px;
		top: 114px;
		width: 383px;
		background: #ffffff;
		border: 1px solid #FEE500;
		border-radius: 10px;
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
		z-index: 11;
		box-sizing: border-box;
		padding: 20px;
		display: none;
	}
	.place-detail-header {
		display: flex;
		justify-content: space-between;
		align-items: flex-start;
		margin-bottom: 8px;
	}
	.place-detail-title {
		font-family: 'Inter', sans-serif;
		font-weight: 500;
		font-size: 18px;
		color: #333;
		margin: 0 0 4px 0;
		display: flex;
		align-items: center;
		gap: 8px;
		flex-wrap: wrap;
	}
	.place-detail-title > span:first-child {
		font-weight: 500;
	}
	.place-detail-category {
		font-family: 'Inter', sans-serif;
		font-weight: 400;
		font-size: 13px;
		color: #999;
		background: #f5f5f5;
		padding: 4px 10px;
		border-radius: 12px;
		white-space: nowrap;
	}
	.place-detail-reviews {
		font-family: 'Inter', sans-serif;
		font-weight: 400;
		font-size: 14px;
		color: #666;
		margin-bottom: 8px;
	}
	.place-detail-photo {
		margin-top: 40px;
		width: 100%;
		height: 162px;
		background: #f9f9f9;
		border-radius: 8px;
		display: flex;
		align-items: center;
		justify-content: center;
		color: #999;
		font-family: 'Inter', sans-serif;
		font-size: 14px;
		border: 1px solid #e5e5e5;
	}
	.place-detail-close {
		cursor: pointer;
		width: 24px;
		height: 24px;
		display: flex;
		align-items: center;
		justify-content: center;
		color: #666;
		font-size: 20px;
		line-height: 1;
	}
	.place-detail-info {
		display: flex;
		flex-direction: column;
		gap: 10px;
		margin-top: 12px;
		font-family: 'Inter', sans-serif;
		font-size: 14px;
		color: #666;
	}
	.place-detail-info-item {
		display: flex;
		align-items: flex-start;
		gap: 8px;
	}
	.place-detail-icon {
		width: 16px;
		height: 16px;
		margin-top: 2px;
		opacity: 0.6;
	}
	.search-results {
		position: absolute;
		left: 52px;
		top: 114px;
		width: 383px;
		height: 792px;
		background: #ffffff;
		border: 1px solid #FEE500;
		border-radius: 10px;
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
		overflow: hidden;
		z-index: 10;
		box-sizing: border-box;
		display: flex;
		flex-direction: column;
	}
	.result-filters {
		padding: 16px 26px 4px 26px;
		display: flex;
		gap: 8px;
		flex-wrap: wrap;
	}
		.filter-btn {
			padding: 6px 14px;
			border: 1px solid #ddd;
			border-radius: 18px;
			background: #ffffff;
			color: #666;
			font-family: 'Inter', sans-serif;
			font-weight: 400;
			font-size: 13px;
			cursor: pointer;
			display: flex;
			align-items: center;
			gap: 4px;
			transition: all 0.2s;
			height: 32px;
			box-sizing: border-box;
		}
		.filter-btn[data-filter="type"] {
			padding: 6px 11px;
		}
		.filter-btn:hover {
			background: #f9f9f9;
		}
		.filter-btn.active {
			background: #FEE500;
			border-color: #FEE500;
			color: #000;
			font-weight: 500;
		}
	.result-list {
		flex: 1;
		overflow-y: auto;
		padding: 16px 26px;
	}
		.result-item {
			padding: 16px 0;
			border-bottom: 1px solid #f0f0f0;
			cursor: pointer;
			margin: 0;
		}
		.result-item:first-child {
			padding-top: 0;
		}
		.result-item:last-child {
			border-bottom: none;
		}
	.result-item:hover {
		background: #f9f9f9;
		margin: 0 -26px;
		padding: 16px 26px;
	}
	.result-item:first-child:hover {
		padding: 0 26px 16px 26px;
	}
		.result-header {
			display: flex;
			justify-content: space-between;
			align-items: flex-start;
			margin-bottom: 8px;
		}
		.result-name {
			font-family: 'Inter', sans-serif;
			font-weight: 500;
			font-size: 16px;
			color: #333;
			margin: 0;
		}
		.result-status {
			font-family: 'Inter', sans-serif;
			font-weight: 400;
			font-size: 12px;
			color: #666;
			margin-top: 4px;
		}
		.result-hours {
			font-family: 'Inter', sans-serif;
			font-weight: 400;
			font-size: 12px;
			color: #999;
			margin-top: 4px;
		}
		.result-info {
			display: flex;
			align-items: center;
			gap: 8px;
			margin-top: 8px;
			font-family: 'Inter', sans-serif;
			font-weight: 400;
			font-size: 12px;
			color: #666;
		}
		.result-thumbnail {
			width: 60px;
			height: 60px;
			border-radius: 8px;
			object-fit: cover;
			background: #f0f0f0;
		}
		.result-content {
			display: flex;
			gap: 12px;
		}
		.result-details {
			flex: 1;
		}
		.accessibility-tag {
			display: inline-block;
			padding: 2px 8px;
			background: #f0f0f0;
			border-radius: 4px;
			font-size: 11px;
			margin-right: 4px;
		}
	</style>
</head>
<body>
	<div class="search-box">
		<input type="text" placeholder="ì¥ì†Œ ê²€ìƒ‰" id="searchInput">
		<div class="search-icon" id="searchBtn">
			<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
				<path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
			</svg>
		</div>
	</div>
	<div class="place-detail" id="placeDetail">
		<div class="place-detail-header">
			<div style="flex: 1;">
				<h2 class="place-detail-title">
					<span id="placeTitle">ë§¤ì¥ëª…</span>
					<span class="place-detail-category" id="placeCategory">ì¹´í…Œê³ ë¦¬</span>
				</h2>
				<div class="place-detail-reviews" id="placeReviews">ë¦¬ë·° 999+</div>
			</div>
			<div class="place-detail-close" id="placeDetailClose">Ã—</div>
		</div>
		<div class="place-detail-info">
			<div class="place-detail-info-item">
				<span>ğŸ“</span>
				<span id="placeAddress">ì£¼ì†Œ</span>
			</div>
			<div class="place-detail-info-item">
				<span>ğŸ“</span>
				<span id="placePhone">ì „í™”ë²ˆí˜¸</span>
			</div>
		</div>
		<div class="place-detail-photo" id="placePhoto">
			ì‚¬ì§„ ì¤€ë¹„ì¤‘
		</div>
	</div>
	<div class="search-results" id="searchResults" style="display: none;">
		<div class="result-filters">
			<button class="filter-btn" data-filter="type">
				<img src="/img/filter-icon.png" alt="í•„í„°" style="width: 36px; height: 36px;">
			</button>
			<button class="filter-btn" data-filter="open">
				<span>ì˜ì—…ì¤‘</span>
			</button>
			<button class="filter-btn" data-filter="ramp">
				<span>ê²½ì‚¬ë¡œ</span>
			</button>
			<button class="filter-btn" data-filter="wheelchair">
				<img src="/img/wheelchair-icon.svg" alt="íœ ì²´ì–´" style="width: 13.6px; height: 17px; opacity: 0.8;">
				<span>í™”ì¥ì‹¤</span>
			</button>
		</div>
		<div class="result-list" id="resultList"></div>
	</div>
	<div id="map"></div>

	<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=01785b9a288ab46417b78a3790ac85c5&libraries=services"></script>
	<script>
		var container = document.getElementById('map');
		var options = {
			center: new kakao.maps.LatLng(36.3734, 127.3628), //KAIST ì¤‘ì‹¬ì¢Œí‘œ
			level: 4
		};

		var map = new kakao.maps.Map(container, options);
		var places = new kakao.maps.services.Places();
		var markers = [];
		var currentCategory = null;

// ê²€ìƒ‰ í•¨ìˆ˜
function searchPlaces(keyword, category) {
	console.log('=== searchPlaces í•¨ìˆ˜ ì‹¤í–‰ ===');
	console.log('í‚¤ì›Œë“œ:', keyword);
	console.log('ì¹´í…Œê³ ë¦¬:', category);
	
	// ê¸°ì¡´ ë§ˆì»¤ ì œê±°
	markers.forEach(marker => marker.setMap(null));
	markers = [];
	
	// ìƒì„¸ ì •ë³´ íŒ¨ë„ ìˆ¨ê¸°ê¸°
	document.getElementById('placeDetail').style.display = 'none';

	var callback = function(data, status) {
		console.log('ê²€ìƒ‰ ìƒíƒœ:', status);
		console.log('ê²€ìƒ‰ ë°ì´í„°:', data);
		
		if (status === kakao.maps.services.Status.OK) {
			console.log('ê²€ìƒ‰ ì„±ê³µ! ê²°ê³¼ ìˆ˜:', data.length);
			displayResults(data);
			displayMarkers(data);
			
			// ê²€ìƒ‰ ê²°ê³¼ íŒ¨ë„ í‘œì‹œ
			document.getElementById('searchResults').style.display = 'flex';
			
			// ì§€ë„ ë²”ìœ„ ì¡°ì •
			var bounds = new kakao.maps.LatLngBounds();
			data.forEach(place => {
				bounds.extend(new kakao.maps.LatLng(place.y, place.x));
			});
			map.setBounds(bounds);
		} else if (status === kakao.maps.services.Status.ZERO_RESULT) {
			console.log('ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ');
			document.getElementById('resultList').innerHTML = '<div style="padding: 26px; text-align: center; color: #999;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
			document.getElementById('searchResults').style.display = 'flex';
		} else if (status === kakao.maps.services.Status.ERROR) {
			console.error('ê²€ìƒ‰ ì—ëŸ¬ ë°œìƒ!');
			document.getElementById('resultList').innerHTML = '<div style="padding: 26px; text-align: center; color: #f44;">ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
			document.getElementById('searchResults').style.display = 'flex';
		} else {
			console.log('ê¸°íƒ€ ìƒíƒœ:', status);
			document.getElementById('resultList').innerHTML = '<div style="padding: 26px; text-align: center; color: #999;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
			document.getElementById('searchResults').style.display = 'flex';
		}
	};

			if (category) {
				// ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰
				places.categorySearch(category, callback, {
					location: map.getCenter(),
					radius: 5000
				});
			} else if (keyword) {
				// í‚¤ì›Œë“œ ê²€ìƒ‰
				places.keywordSearch(keyword, callback, {
					location: map.getCenter(),
					radius: 5000
				});
			}
		}

	// ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
	function displayResults(data) {
		// ë””ë²„ê¹…: ëª¨ë“  ê²€ìƒ‰ ê²°ê³¼ì˜ ì¹´í…Œê³ ë¦¬ ì¶œë ¥
		console.log('=== ê²€ìƒ‰ ê²°ê³¼ ===');
		data.forEach((place, idx) => {
			console.log(`${idx + 1}. ${place.place_name}`);
			console.log('   ì¹´í…Œê³ ë¦¬:', place.category_name);
		});
		console.log('==================');
		
		var resultsHtml = '';
		data.forEach((place, index) => {
				var status = place.place_url ? 'ì˜ì—…ì¤‘' : 'ì •ë³´ ì—†ìŒ';
				var hours = place.place_url ? 'ì˜ì—… ì‹œê°„ ì •ë³´ ì—†ìŒ' : '';
				var reviewCount = place.place_url ? 'ë¦¬ë·° ì •ë³´ ì—†ìŒ' : '';
				
				resultsHtml += `
					<div class="result-item" data-index="${index}">
						<div class="result-content">
							<div class="result-details">
								<div class="result-header">
									<div>
										<h3 class="result-name">${place.place_name}</h3>
										<div class="result-status">${status}</div>
										<div class="result-hours">${hours}</div>
									</div>
								</div>
								<div class="result-info">
									<span>${reviewCount}</span>
									<span class="accessibility-tag">ì ‘ê·¼ì„± ì •ë³´</span>
								</div>
							</div>
							<img src="${place.place_url ? 'https://via.placeholder.com/60' : 'https://via.placeholder.com/60'}" alt="${place.place_name}" class="result-thumbnail" onerror="this.src='https://via.placeholder.com/60'">
						</div>
					</div>
				`;
			});
			document.getElementById('resultList').innerHTML = resultsHtml;

	// ê²°ê³¼ í•­ëª© í´ë¦­ ì´ë²¤íŠ¸
	document.querySelectorAll('.result-item').forEach((item, index) => {
		item.addEventListener('click', function() {
			var place = data[index];
			var position = new kakao.maps.LatLng(place.y, place.x);
			map.setCenter(position);
			map.setLevel(3);
			
			// í•´ë‹¹ ë§ˆì»¤ ì°¾ê¸°
			var selectedMarker = markers[index];
			
			// ìƒì„¸ ì •ë³´ í‘œì‹œ
			showPlaceDetail(place, selectedMarker);
		});
	});
}

	// ë§¤ì¥ ìƒì„¸ ì •ë³´ í‘œì‹œ
	function showPlaceDetail(place, selectedMarker) {
		// ê²€ìƒ‰ì°½ ë¹„ìš°ê¸°
		document.getElementById('searchInput').value = '';
		
		// ë””ë²„ê¹…: ì „ì²´ ì¹´í…Œê³ ë¦¬ ì •ë³´ ì¶œë ¥
		console.log('=== ë§¤ì¥ ì •ë³´ ===');
		console.log('ë§¤ì¥ëª…:', place.place_name);
		console.log('ì „ì²´ ì¹´í…Œê³ ë¦¬:', place.category_name);
		console.log('ì£¼ì†Œ:', place.address_name);
		
		// ë§¤ì¥ëª…
		document.getElementById('placeTitle').textContent = place.place_name;
		
	// ì¹´í…Œê³ ë¦¬ - ì¡°ê±´ë¶€ í‘œì‹œ
	var category = 'ì¹´í…Œê³ ë¦¬ ì •ë³´ ì—†ìŒ';
	if (place.category_name) {
		var categories = place.category_name.split('>').map(c => c.trim());
		var lowestCategory = categories[categories.length - 1]; // ì œì¼ í•˜ìœ„ ë¶„ë¥˜
		
		// ë§¤ì¥ëª…ì˜ ì²« ë‹¨ì–´ ì¶”ì¶œ
		var firstWord = place.place_name.split(' ')[0];
		
		// ì²« ë‹¨ì–´ì™€ ì œì¼ í•˜ìœ„ ë¶„ë¥˜ ë¹„êµ
		if (firstWord === lowestCategory && categories.length > 1) {
			// ê°™ìœ¼ë©´ í•œ ë‹¨ê³„ ìƒìœ„ ë¶„ë¥˜ í‘œì‹œ
			category = categories[categories.length - 2];
		} else {
			// ë‹¤ë¥´ë©´ ì œì¼ í•˜ìœ„ ë¶„ë¥˜ í‘œì‹œ
			category = lowestCategory;
		}
		
		console.log('ì¹´í…Œê³ ë¦¬ ë°°ì—´:', categories);
		console.log('ì²« ë‹¨ì–´:', firstWord);
		console.log('í•˜ìœ„ ë¶„ë¥˜:', lowestCategory);
		console.log('í‘œì‹œí•  ì¹´í…Œê³ ë¦¬:', category);
	}
	document.getElementById('placeCategory').textContent = category;
		
	// ë¦¬ë·° ê°œìˆ˜ (ì„ì‹œë¡œ ëœë¤ ìƒì„± - ì‹¤ì œë¡œëŠ” APIì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨)
	var reviewCount = Math.floor(Math.random() * 1500) + 50;
	var reviewText = reviewCount >= 1000 ? 'ë¦¬ë·° 999+' : 'ë¦¬ë·° ' + reviewCount;
	document.getElementById('placeReviews').textContent = reviewText;
		
		// ì£¼ì†Œì™€ ì „í™”ë²ˆí˜¸
		document.getElementById('placeAddress').textContent = place.address_name || place.road_address_name || 'ì£¼ì†Œ ì •ë³´ ì—†ìŒ';
		document.getElementById('placePhone').textContent = place.phone || 'ì „í™”ë²ˆí˜¸ ì •ë³´ ì—†ìŒ';
		
		// ì„ íƒëœ ë§ˆì»¤ë¥¼ ì œì™¸í•œ ëª¨ë“  ë§ˆì»¤ ìˆ¨ê¸°ê¸°
		markers.forEach(marker => {
			if (marker.placeData && 
				marker.placeData.place_name === place.place_name && 
				marker.placeData.x === place.x && 
				marker.placeData.y === place.y) {
				marker.setMap(map); // ì„ íƒëœ ë§ˆì»¤ë§Œ í‘œì‹œ
			} else {
				marker.setMap(null); // ë‚˜ë¨¸ì§€ ë§ˆì»¤ ìˆ¨ê¸°ê¸°
			}
		});
		
		// ê²€ìƒ‰ ê²°ê³¼ íŒ¨ë„ ìˆ¨ê¸°ê³  ìƒì„¸ ì •ë³´ í‘œì‹œ
		document.getElementById('searchResults').style.display = 'none';
		document.getElementById('placeDetail').style.display = 'block';
	}

	// ë§ˆì»¤ í‘œì‹œ
	function displayMarkers(data) {
		data.forEach((place, index) => {
			var marker = new kakao.maps.Marker({
				position: new kakao.maps.LatLng(place.y, place.x),
				map: map
			});
			
			// ë§ˆì»¤ì— place ì •ë³´ ì €ì¥
			marker.placeData = place;
			markers.push(marker);

			// ì¸í¬ìœˆë„ìš°
			var infowindow = new kakao.maps.InfoWindow({
				content: '<div style="padding:5px;font-size:12px;">' + place.place_name + '</div>'
			});

			kakao.maps.event.addListener(marker, 'click', function() {
				infowindow.open(map, marker);
				// ë§ˆì»¤ í´ë¦­ ì‹œì—ë„ ìƒì„¸ ì •ë³´ í‘œì‹œ
				showPlaceDetail(place, marker);
				map.setCenter(new kakao.maps.LatLng(place.y, place.x));
				map.setLevel(3);
			});
		});
	}

	// ìƒì„¸ ì •ë³´ ë‹«ê¸° ë²„íŠ¼
	document.getElementById('placeDetailClose').addEventListener('click', function() {
		// ëª¨ë“  ë§ˆì»¤ ë‹¤ì‹œ í‘œì‹œ
		markers.forEach(marker => {
			marker.setMap(map);
		});
		
		document.getElementById('placeDetail').style.display = 'none';
		document.getElementById('searchResults').style.display = 'flex';
	});

	// ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­
	document.getElementById('searchBtn').addEventListener('click', function() {
		var keyword = document.getElementById('searchInput').value.trim();
		console.log('ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­! í‚¤ì›Œë“œ:', keyword);
		if (keyword) {
			console.log('í‚¤ì›Œë“œ ê²€ìƒ‰ ì‹¤í–‰:', keyword);
			searchPlaces(keyword, null);
		} else if (currentCategory) {
			console.log('ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰ ì‹¤í–‰:', currentCategory);
			searchPlaces(null, currentCategory);
		} else {
			console.log('ê²€ìƒ‰ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.');
		}
	});

	// ì—”í„°í‚¤ ê²€ìƒ‰
	document.getElementById('searchInput').addEventListener('keypress', function(e) {
		if (e.key === 'Enter') {
			var keyword = this.value.trim();
			console.log('ì—”í„°í‚¤ ì…ë ¥! í‚¤ì›Œë“œ:', keyword);
			if (keyword) {
				console.log('í‚¤ì›Œë“œ ê²€ìƒ‰ ì‹¤í–‰:', keyword);
				searchPlaces(keyword, null);
			} else if (currentCategory) {
				console.log('ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰ ì‹¤í–‰:', currentCategory);
				searchPlaces(null, currentCategory);
			} else {
				console.log('ê²€ìƒ‰ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.');
			}
		}
	});

		// í•„í„° ë²„íŠ¼ í´ë¦­
		document.querySelectorAll('.filter-btn').forEach(btn => {
			btn.addEventListener('click', function() {
				this.classList.toggle('active');
				// í•„í„°ë§ ë¡œì§ì€ ì—¬ê¸°ì— ì¶”ê°€ ê°€ëŠ¥
				console.log('Filter:', this.dataset.filter, 'Active:', this.classList.contains('active'));
			});
		});
	</script>
</body>
</html>

<!-- ë¡œê·¸ì¸ íŒì—… ìŠ¤íƒ€ì¼/ìŠ¤í¬ë¦½íŠ¸ (ì¶”ê°€) -->
<link rel="stylesheet" href="/auth.css">
<script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
<script src="/auth.js"></script>
