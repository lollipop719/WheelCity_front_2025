<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Kakao 지도</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@500&display=swap" rel="stylesheet">
	<style>
		html, body {
			margin: 0;
			padding: 0;
			width: 100%;
			height: 100%;
			overflow: hidden;
		}
		#map {
			width: 100%;
			height: 100%;
		}
		.search-box {
			position: absolute;
			left: 52px;
			top: 59px;
			width: 383px;
			height: 45px;
			background: #ffffff;
			border: 1px solid #FEE500;
			border-radius: 10px;
			display: flex;
			align-items: center;
			padding: 0 16px;
			box-sizing: border-box;
			z-index: 10;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
		}
		.search-box input {
			flex: 1;
			border: none;
			outline: none;
			font-family: 'Inter', sans-serif;
			font-weight: 500;
			font-size: 15px;
			background: transparent;
			color: #333;
		}
		.search-box input::placeholder {
			color: #999;
		}
		.search-icon {
			width: 20px;
			height: 20px;
			margin-left: 12px;
			cursor: pointer;
		}
		.search-icon svg {
			width: 100%;
			height: 100%;
			fill: #666;
		}
		.search-results {
			position: absolute;
			left: 52px;
			top: 114px;
			width: 383px;
			height: 792px;
			background: #ffffff;
			border: 1px solid #FEE500;
			border-radius: 10px;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
			overflow: hidden;
			z-index: 10;
			box-sizing: border-box;
			display: flex;
			flex-direction: column;
		}
		.result-filters {
			padding: 16px 20px 4px 20px;
			display: flex;
			gap: 8px;
			flex-wrap: wrap;
		}
		.filter-btn {
			padding: 6px 14px;
			border: 1px solid #ddd;
			border-radius: 18px;
			background: #ffffff;
			color: #666;
			font-family: 'Inter', sans-serif;
			font-weight: 400;
			font-size: 13px;
			cursor: pointer;
			display: flex;
			align-items: center;
			gap: 4px;
			transition: all 0.2s;
			height: 32px;
			box-sizing: border-box;
		}
		.filter-btn[data-filter="type"] {
			padding: 6px 11px;
		}
		.filter-btn:hover {
			background: #f9f9f9;
		}
		.filter-btn.active {
			background: #FEE500;
			border-color: #FEE500;
			color: #000;
			font-weight: 500;
		}
		.result-list {
			flex: 1;
			overflow-y: auto;
			padding: 16px 20px;
		}
		.result-item {
			padding: 16px 0;
			border-bottom: 1px solid #f0f0f0;
			cursor: pointer;
			margin: 0;
		}
		.result-item:first-child {
			padding-top: 0;
		}
		.result-item:last-child {
			border-bottom: none;
		}
		.result-item:hover {
			background: #f9f9f9;
			margin: 0 -20px;
			padding: 16px 20px;
		}
		.result-item:first-child:hover {
			padding-top: 0;
		}
		.result-header {
			display: flex;
			justify-content: space-between;
			align-items: flex-start;
			margin-bottom: 8px;
		}
		.result-name {
			font-family: 'Inter', sans-serif;
			font-weight: 500;
			font-size: 16px;
			color: #333;
			margin: 0;
		}
		.result-status {
			font-family: 'Inter', sans-serif;
			font-weight: 400;
			font-size: 12px;
			color: #666;
			margin-top: 4px;
		}
		.result-hours {
			font-family: 'Inter', sans-serif;
			font-weight: 400;
			font-size: 12px;
			color: #999;
			margin-top: 4px;
		}
		.result-info {
			display: flex;
			align-items: center;
			gap: 8px;
			margin-top: 8px;
			font-family: 'Inter', sans-serif;
			font-weight: 400;
			font-size: 12px;
			color: #666;
		}
		.result-thumbnail {
			width: 60px;
			height: 60px;
			border-radius: 8px;
			object-fit: cover;
			background: #f0f0f0;
		}
		.result-content {
			display: flex;
			gap: 12px;
		}
		.result-details {
			flex: 1;
		}
		.accessibility-tag {
			display: inline-block;
			padding: 2px 8px;
			background: #f0f0f0;
			border-radius: 4px;
			font-size: 11px;
			margin-right: 4px;
		}
	</style>
</head>
<body>
	<div class="search-box">
		<input type="text" placeholder="장소 검색" id="searchInput">
		<div class="search-icon" id="searchBtn">
			<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
				<path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
			</svg>
		</div>
	</div>
	<div class="search-results" id="searchResults" style="display: none;">
		<div class="result-filters">
			<button class="filter-btn" data-filter="type">
				<img src="/img/filter-icon.png" alt="필터" style="width: 36px; height: 36px;">
			</button>
			<button class="filter-btn" data-filter="open">
				<span>영업중</span>
			</button>
			<button class="filter-btn" data-filter="ramp">
				<span>경사로</span>
			</button>
			<button class="filter-btn" data-filter="wheelchair">
				<img src="/img/wheelchair-icon.svg" alt="휠체어" style="width: 13.6px; height: 17px; opacity: 0.8;">
				<span>화장실</span>
			</button>
		</div>
		<div class="result-list" id="resultList"></div>
	</div>
	<div id="map"></div>

	<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=d96c2bf65fd166e398605c573c95dbae&libraries=services"></script>
	<script>
		var container = document.getElementById('map');
		var options = {
			center: new kakao.maps.LatLng(36.3734, 127.3628), //KAIST 중심좌표
			level: 4
		};

		var map = new kakao.maps.Map(container, options);
		var places = new kakao.maps.services.Places();
		var markers = [];
		var currentCategory = null;

		// 검색 함수
		function searchPlaces(keyword, category) {
			// 기존 마커 제거
			markers.forEach(marker => marker.setMap(null));
			markers = [];

			var callback = function(data, status) {
				if (status === kakao.maps.services.Status.OK) {
					displayResults(data);
					displayMarkers(data);
					
					// 검색 결과 패널 표시
					document.getElementById('searchResults').style.display = 'flex';
					
					// 지도 범위 조정
					var bounds = new kakao.maps.LatLngBounds();
					data.forEach(place => {
						bounds.extend(new kakao.maps.LatLng(place.y, place.x));
					});
					map.setBounds(bounds);
				} else {
					document.getElementById('resultList').innerHTML = '<div style="padding: 20px; text-align: center; color: #999;">검색 결과가 없습니다.</div>';
					document.getElementById('searchResults').style.display = 'flex';
				}
			};

			if (category) {
				// 카테고리 검색
				places.categorySearch(category, callback, {
					location: map.getCenter(),
					radius: 5000
				});
			} else if (keyword) {
				// 키워드 검색
				places.keywordSearch(keyword, callback, {
					location: map.getCenter(),
					radius: 5000
				});
			}
		}

		// 검색 결과 표시
		function displayResults(data) {
			var resultsHtml = '';
			data.forEach((place, index) => {
				var status = place.place_url ? '영업중' : '정보 없음';
				var hours = place.place_url ? '영업 시간 정보 없음' : '';
				var reviewCount = place.place_url ? '리뷰 정보 없음' : '';
				
				resultsHtml += `
					<div class="result-item" data-index="${index}">
						<div class="result-content">
							<div class="result-details">
								<div class="result-header">
									<div>
										<h3 class="result-name">${place.place_name}</h3>
										<div class="result-status">${status}</div>
										<div class="result-hours">${hours}</div>
									</div>
								</div>
								<div class="result-info">
									<span>${reviewCount}</span>
									<span class="accessibility-tag">접근성 정보</span>
								</div>
							</div>
							<img src="${place.place_url ? 'https://via.placeholder.com/60' : 'https://via.placeholder.com/60'}" alt="${place.place_name}" class="result-thumbnail" onerror="this.src='https://via.placeholder.com/60'">
						</div>
					</div>
				`;
			});
			document.getElementById('resultList').innerHTML = resultsHtml;

			// 결과 항목 클릭 이벤트
			document.querySelectorAll('.result-item').forEach((item, index) => {
				item.addEventListener('click', function() {
					var place = data[index];
					var position = new kakao.maps.LatLng(place.y, place.x);
					map.setCenter(position);
					map.setLevel(3);
				});
			});
		}

		// 마커 표시
		function displayMarkers(data) {
			data.forEach(place => {
				var marker = new kakao.maps.Marker({
					position: new kakao.maps.LatLng(place.y, place.x),
					map: map
				});
				markers.push(marker);

				// 인포윈도우
				var infowindow = new kakao.maps.InfoWindow({
					content: '<div style="padding:5px;font-size:12px;">' + place.place_name + '</div>'
				});

				kakao.maps.event.addListener(marker, 'click', function() {
					infowindow.open(map, marker);
				});
			});
		}

		// 검색 버튼 클릭
		document.getElementById('searchBtn').addEventListener('click', function() {
			var keyword = document.getElementById('searchInput').value.trim();
			if (keyword) {
				searchPlaces(keyword, null);
			} else if (currentCategory) {
				searchPlaces(null, currentCategory);
			}
		});

		// 엔터키 검색
		document.getElementById('searchInput').addEventListener('keypress', function(e) {
			if (e.key === 'Enter') {
				var keyword = this.value.trim();
				if (keyword) {
					searchPlaces(keyword, null);
				} else if (currentCategory) {
					searchPlaces(null, currentCategory);
				}
			}
		});

		// 필터 버튼 클릭
		document.querySelectorAll('.filter-btn').forEach(btn => {
			btn.addEventListener('click', function() {
				this.classList.toggle('active');
				// 필터링 로직은 여기에 추가 가능
				console.log('Filter:', this.dataset.filter, 'Active:', this.classList.contains('active'));
			});
		});
	</script>
</body>
</html>
